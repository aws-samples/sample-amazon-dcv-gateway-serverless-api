<mxfile host="app.diagrams.net" modified="2023-12-20">
    <diagram id="architecture" name="NICE DCV Gateway Architecture">
        <mxGraphModel dx="1422" dy="762" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" background="#ffffff">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>

                <!-- User -->
                <mxCell id="user" value="User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="1">
                    <mxGeometry x="50" y="200" width="30" height="60" as="geometry"/>
                </mxCell>

                <!-- API Gateway -->
                <mxCell id="apiGateway" value="API Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
                    <mxGeometry x="200" y="200" width="120" height="60" as="geometry"/>
                </mxCell>

                <!-- Lambda -->
                <mxCell id="lambda" value="Session Management&#xa;Lambda" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
                    <mxGeometry x="400" y="200" width="120" height="60" as="geometry"/>
                </mxCell>

                <!-- DynamoDB -->
                <mxCell id="dynamodb" value="DynamoDB&#xa;Session Table" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
                    <mxGeometry x="400" y="320" width="120" height="60" as="geometry"/>
                </mxCell>

                <!-- VPC Container -->
                <mxCell id="vpc" value="VPC" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;dashed=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
                    <mxGeometry x="600" y="120" width="400" height="320" as="geometry"/>
                </mxCell>

                <!-- NLB -->
                <mxCell id="nlb" value="Network Load Balancer&#xa;(port 8443)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
                    <mxGeometry x="640" y="200" width="120" height="60" as="geometry"/>
                </mxCell>

                <!-- Auto Scaling Group -->
                <mxCell id="asg" value="Auto Scaling Group" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;dashed=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
                    <mxGeometry x="800" y="160" width="160" height="140" as="geometry"/>
                </mxCell>

                <!-- DCV Gateway Instances -->
                <mxCell id="dcvGateway1" value="DCV Gateway&#xa;Instance 1" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="820" y="200" width="120" height="40" as="geometry"/>
                </mxCell>

                <mxCell id="dcvGateway2" value="DCV Gateway&#xa;Instance 2" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="820" y="250" width="120" height="40" as="geometry"/>
                </mxCell>

                <!-- DCV Host Instances -->
                <mxCell id="dcvHosts" value="DCV Host Instances" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;dashed=1;" vertex="1" parent="1">
                    <mxGeometry x="800" y="320" width="160" height="100" as="geometry"/>
                </mxCell>

                <mxCell id="host1" value="DCV Host 1" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="820" y="350" width="120" height="30" as="geometry"/>
                </mxCell>

                <mxCell id="host2" value="DCV Host 2" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="820" y="380" width="120" height="30" as="geometry"/>
                </mxCell>

                <!-- Connections -->
                <mxCell id="conn1" value="1. Request Session" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="user" target="apiGateway">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="conn2" value="2. Create Session" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="apiGateway" target="lambda">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="conn3" value="3. Store Session" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="lambda" target="dynamodb">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="conn4" value="4. Return Token" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="lambda" target="user">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="460" y="160"/>
                            <mxPoint x="65" y="160"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <mxCell id="conn5" value="5. Connect with Token" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="user" target="nlb">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="65" y="280"/>
                            <mxPoint x="700" y="280"/>
                        </Array>
                    </mxGeometry>
                </mxCell>

                <!-- Connection to Gateway -->
                <mxCell id="conn6" value="6. Route Traffic" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="nlb" target="dcvGateway1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Connection to Host -->
                <mxCell id="conn7" value="7. Forward to Host" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="dcvGateway1" target="host1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Notes -->
                <mxCell id="note1" value="Stores:&#xa;- Session ID&#xa;- Instance ID&#xa;- Activation Time&#xa;- Token" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
                    <mxGeometry x="400" y="400" width="120" height="80" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
